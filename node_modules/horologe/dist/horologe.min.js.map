{"version":3,"file":"horologe.min.js","sources":["../node_modules/more-events/index.js","../src/index.js"],"sourcesContent":["//Most for use with gyre\n/*\ngit remote add origin https://github.com/hollowdoor/more_events.git\ngit push -u origin master\n*/\nfunction MoreEvents(context){\n    this.listeners = {};\n    this.__context = context || this;\n}\n\nMoreEvents.prototype = {\n    constructor: MoreEvents,\n    on: function(event, listener){\n        this.listeners[event] = this.listeners[event] || [];\n        this.listeners[event].push(listener);\n        return this;\n    },\n    one: function(event, listener){\n        function onceListener(){\n            listener.apply(this, arguments);\n            this.off(event, onceListener);\n            return this;\n        }\n        return this.on(event, onceListener);\n    },\n    emit: function(event){\n        if(typeof this.listeners[event] === 'undefined' || !this.listeners[event].length)\n            return this;\n\n        var args = Array.prototype.slice.call(arguments, 1),\n            canRun = this.listeners[event].length;\n\n        do{\n            this.listeners[event][--canRun].apply(this.__context, args);\n        }while(canRun);\n\n        return this;\n    },\n    off: function(event, listener){\n        if(this.listeners[event] === undefined || !this.listeners[event].length)\n            return this;\n        this.listeners[event] = this.listeners[event].filter(function(item){\n            return item !== listener;\n        });\n        return this;\n    },\n    dispose: function(){\n        for(var n in this){\n            this[n] = null;\n        }\n    }\n};\n\nmodule.exports.Emitter = MoreEvents;\n","import { Emitter } from 'more-events';\n\nlet getNow = Date.now !== void 0\n? Date.now\n: ()=>new Date().getTime();\n\nconst makeNow = (highres)=>{\n    if(!highres) return getNow;\n\n    let bind = !Function.prototype.bind\n    ? (f, c)=>(...a)=>f.apply(c, a)\n    : (f, c)=>f.bind(c);\n\n    const perfNow = bind((function() {\n      return performance.now       ||\n             performance.mozNow    ||\n             performance.msNow     ||\n             performance.oNow      ||\n             performance.webkitNow ||\n             function() { return getNow(); };\n    })(), performance);\n\n    const navstart = performance.timing.navigationStart;\n\n    return ()=>{\n        return navstart + perfNow();\n    };\n};\n\n\n\nexport default class Timer extends Emitter {\n    constructor(interval = 1000, {\n        sync = 1000,\n        tick = null,\n        highres = false,\n        skip = true\n    } = {}){\n\n        super();\n\n        let now = makeNow(highres);\n\n        let timeoutId = null,\n            running = false,\n            paused = false,\n            pausePassed = false,\n            count = 0,\n            timeRange = Infinity,\n            stopOn = Infinity,\n            startTime = now(),\n            pauseCount = 0,\n            pauseLimit = Infinity;\n\n\n        if(typeof tick === 'function'){\n            this.on('tick', tick);\n        }\n\n        Object.defineProperties(this, {\n            interval: {get(){ return interval; }},\n            paused: {get(){ return paused; }},\n            running: {get(){ return running; }},\n            count: {get(){ return count; }},\n            percent: {get(){\n                return ~~((count - pauseCount * interval / interval) / (timeRange / interval) * 100 + 0.5);\n            }},\n            startTime: {get(){ return startTime; }}\n        });\n\n        let interrupt = ()=>{\n            clearTimeout(timeoutId);\n            timeoutId = null;\n            running = false;\n        };\n\n        let ready = (startTime, next, mil)=>{\n            paused = false;\n            running = true;\n            timeoutId = setTimeout(next, mil);\n            this.emit('start', startTime);\n        };\n\n        let next = ()=>{\n            if(!running) return;\n\n            var time = now();\n            //The less accurate diffing\n            //var diff = (time - startTime) % interval;\n            var diff = (time - startTime) - (++count * interval);\n\n            time = time - diff;\n\n            let passed = (time - startTime) - pauseCount * interval;\n\n            timeoutId = setTimeout(next, interval - diff);\n\n            if(!paused){\n                this.emit('tick', time, passed, diff);\n            }else{\n                ++pauseCount;\n                if((pauseCount + 1) * interval > pauseLimit){\n                    this.start();\n                }\n            }\n\n            if(time > startTime + timeRange + pauseCount * interval){\n                this.emit('complete', time, passed);\n                this.stop();\n            }\n        };\n\n        function stop(){\n            count = 0;\n            stopOn = Infinity;\n            paused = false;\n            pauseCount = 0;\n            startTime = null;\n            interrupt();\n            this.emit('stop');\n            return this;\n        }\n\n        function pause(limit = Infinity){\n            paused = true;\n            pauseLimit = limit;\n            this.emit('pause');\n            return this;\n        }\n\n        function range(r){\n            if(r === undefined){\n                return timeRange;\n            }\n            timeRange = r;\n            return this;\n        }\n\n        function start(wait = 0){\n            let i = interval;\n\n            if(!paused && running){\n                return this;\n            }\n\n            if(wait){\n                i = wait;\n\n                if(!paused){\n                    startTime = now();\n\n                    if(sync){\n                        let diff = startTime % sync;\n                        let round = wait < interval\n                        ? 0 : interval;\n\n                        startTime = startTime - diff + round;\n                    }\n                }\n            }else if(!paused){\n                startTime = now();\n\n                if(sync){\n                    let diff = startTime % sync;\n                    let round = diff < interval / 2\n                    ? 0 : interval;\n\n                    startTime = startTime - diff + round;\n\n                    i = diff + round;\n                }\n            }\n\n            ready(startTime, next, i);\n            return this;\n        }\n\n        /*function start(wait = 0){\n\n            if(!paused){\n                startTime = now();\n            }\n\n            if(sync){\n                let original = startTime;\n                let startInterval = wait ? wait : interval;\n\n\n\n                if(!paused){\n                    let diff = startTime % sync;\n                    startTime = startTime - diff + wait;\n                    startInterval = wait\n                    ? wait\n                    : interval - diff + interval;\n                }\n\n                console.log('original ',original)\n                console.log('startTime ',startTime)\n                console.log('startInterval ',startInterval)\n\n                ready(startTime, next, startInterval);\n                return this;\n            }\n\n            ready(startTime, next, interval + wait);\n            return this;\n        }*/\n\n        this.stop = stop;\n        this.pause = pause;\n        this.range = range;\n        this.start = start;\n    }\n    dispose(){\n        super.dispose();\n        Object.keys(this).forEach(key=>{\n            try{\n                delete this[key];\n            }catch(e){}\n        });\n    }\n}\n\nTimer.create = (interval, options)=>{\n    return new Timer(interval, options);\n};\n\nTimer.now = getNow;\n"],"names":["MoreEvents","context","this","listeners","__context","prototype","constructor","on","event","listener","push","one","onceListener","apply","arguments","off","emit","length","args","Array","slice","call","canRun","undefined","filter","item","dispose","n","getNow","Date","now","getTime","makeNow","highres","let","perfNow","Function","bind","f","c","a","performance","mozNow","msNow","oNow","webkitNow","navstart","timing","navigationStart","Timer","interval","ref","super","timeoutId","running","paused","count","timeRange","Infinity","startTime","pauseCount","pauseLimit","tick","Object","defineProperties","get","percent","interrupt","clearTimeout","ready","next","mil","setTimeout","time","diff","passed","start","stop","pause","limit","range","r","wait","i","sync","round","keys","forEach","key","e","Emitter","create","options"],"mappings":"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"}