{"version":3,"file":"bundle.es.js","sources":["../src/index.js"],"sourcesContent":["import { Emitter } from 'more-events';\n\nlet getNow = Date.now !== void 0\n? Date.now\n: ()=>new Date().getTime();\n\nconst makeNow = (highres)=>{\n    if(!highres) return getNow;\n\n    let bind = !Function.prototype.bind\n    ? (f, c)=>(...a)=>f.apply(c, a)\n    : (f, c)=>f.bind(c);\n\n    const perfNow = bind((function() {\n      return performance.now       ||\n             performance.mozNow    ||\n             performance.msNow     ||\n             performance.oNow      ||\n             performance.webkitNow ||\n             function() { return getNow(); };\n    })(), performance);\n\n    const navstart = performance.timing.navigationStart;\n\n    return ()=>{\n        return navstart + perfNow();\n    };\n};\n\n\n\nexport default class Timer extends Emitter {\n    constructor(interval = 1000, {\n        sync = 1000,\n        tick = null,\n        highres = false,\n        skip = true\n    } = {}){\n\n        super();\n\n        let now = makeNow(highres);\n\n        let timeoutId = null,\n            running = false,\n            paused = false,\n            pausePassed = false,\n            count = 0,\n            timeRange = Infinity,\n            stopOn = Infinity,\n            startTime = now(),\n            pauseCount = 0,\n            pauseLimit = Infinity;\n\n\n        if(typeof tick === 'function'){\n            this.on('tick', tick);\n        }\n\n        Object.defineProperties(this, {\n            interval: {get(){ return interval; }},\n            paused: {get(){ return paused; }},\n            running: {get(){ return running; }},\n            count: {get(){ return count; }},\n            percent: {get(){\n                return ~~((count - pauseCount * interval / interval) / (timeRange / interval) * 100 + 0.5);\n            }},\n            startTime: {get(){ return startTime; }}\n        });\n\n        let interrupt = ()=>{\n            clearTimeout(timeoutId);\n            timeoutId = null;\n            running = false;\n        };\n\n        let ready = (startTime, next, mil)=>{\n            paused = false;\n            running = true;\n            timeoutId = setTimeout(next, mil);\n            this.emit('start', startTime);\n        };\n\n        let next = ()=>{\n            if(!running) return;\n\n            var time = now();\n            //The less accurate diffing\n            //var diff = (time - startTime) % interval;\n            var diff = (time - startTime) - (++count * interval);\n\n            time = time - diff;\n\n            let passed = (time - startTime) - pauseCount * interval;\n\n            timeoutId = setTimeout(next, interval - diff);\n\n            if(!paused){\n                this.emit('tick', time, passed, diff);\n            }else{\n                ++pauseCount;\n                if((pauseCount + 1) * interval > pauseLimit){\n                    this.start();\n                }\n            }\n\n            if(time > startTime + timeRange + pauseCount * interval){\n                this.emit('complete', time, passed);\n                this.stop();\n            }\n        };\n\n        function stop(){\n            count = 0;\n            stopOn = Infinity;\n            paused = false;\n            pauseCount = 0;\n            startTime = null;\n            interrupt();\n            this.emit('stop');\n            return this;\n        }\n\n        function pause(limit = Infinity){\n            paused = true;\n            pauseLimit = limit;\n            this.emit('pause');\n            return this;\n        }\n\n        function range(r){\n            if(r === undefined){\n                return timeRange;\n            }\n            timeRange = r;\n            return this;\n        }\n\n        function start(wait = 0){\n            let i = interval;\n\n            if(!paused && running){\n                return this;\n            }\n\n            if(wait){\n                i = wait;\n\n                if(!paused){\n                    startTime = now();\n\n                    if(sync){\n                        let diff = startTime % sync;\n                        let round = wait < interval\n                        ? 0 : interval;\n\n                        startTime = startTime - diff + round;\n                    }\n                }\n            }else if(!paused){\n                startTime = now();\n\n                if(sync){\n                    let diff = startTime % sync;\n                    let round = diff < interval / 2\n                    ? 0 : interval;\n\n                    startTime = startTime - diff + round;\n\n                    i = diff + round;\n                }\n            }\n\n            ready(startTime, next, i);\n            return this;\n        }\n\n        /*function start(wait = 0){\n\n            if(!paused){\n                startTime = now();\n            }\n\n            if(sync){\n                let original = startTime;\n                let startInterval = wait ? wait : interval;\n\n\n\n                if(!paused){\n                    let diff = startTime % sync;\n                    startTime = startTime - diff + wait;\n                    startInterval = wait\n                    ? wait\n                    : interval - diff + interval;\n                }\n\n                console.log('original ',original)\n                console.log('startTime ',startTime)\n                console.log('startInterval ',startInterval)\n\n                ready(startTime, next, startInterval);\n                return this;\n            }\n\n            ready(startTime, next, interval + wait);\n            return this;\n        }*/\n\n        this.stop = stop;\n        this.pause = pause;\n        this.range = range;\n        this.start = start;\n    }\n    dispose(){\n        super.dispose();\n        Object.keys(this).forEach(key=>{\n            try{\n                delete this[key];\n            }catch(e){}\n        });\n    }\n}\n\nTimer.create = (interval, options)=>{\n    return new Timer(interval, options);\n};\n\nTimer.now = getNow;\n"],"names":["let","const","super","this","diff","round"],"mappings":"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"}